<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ws</title>
    <style>
    #main{
        background: #eee;
        border: 1px solid #000;
        border-radius: 4px;
        height: 500px;
        overflow: scroll
    }
    .b{
        padding: 3px;
        /* background: yellowgreen; */
        background: #fff;
        border: 1px solid #aaa;
        border-radius: 4px; 
        margin: 3px;
        display: inline-block;
        max-width: 60%;
        vertical-align: top;
        text-align: left;
        word-break: break-all
    }
    .chat{
        padding: 3px;
        /* text-align: right; */
    }
    .mychat{
        padding: 3px;
        text-align: right;
    }
    .mychat>span.b{
        background: yellowgreen;
    }
    </style>
    <script src="js/socket.io.dev.js"></script>
</head>

<body>
<h3>欢迎加入聊天室！</h3>
<p>给自己取个昵称：<input type="text" id="a"  /> <button onclick="a()"> 确定</button></p>
<div id="main">

</div>
<div>
    <input type="text" id="c" ><button onclick="sub()">提交</button>
</div>
</body>

<script>
    // 使用socket.io
    var socket=null
    function a() {
        socket = io()
        socket.username = document.getElementById('a').value
        socket.on('connect',function () {
            console.log(socket.id);
            socket.emit('username',document.getElementById('a').value )
        })
        socket.on('msg',function (v) {
            console.log(v)
            console.log(socket.id)
            let newd = document.createElement('div')
            v.socketid === socket.id?newd.className = 'mychat':newd.className = 'chat'
            
            let newp0 = document.createElement('span')
            newp0.innerText = v.username+" : "
            newp0.className = 'bb'
            let newp = document.createElement('span')
            newp.innerText = v.data
            newp.className = 'b'

            newd.appendChild(newp0)
            newd.appendChild(newp)
            
            document.getElementById('main').appendChild(newd)

        })
        socket.on('welcome',function (v) {
            console.log(v)
        })
        socket.on('news',function (v) {
            console.log(v)

        })
        socket.on('hello',function (v) {
            console.log(v)
            let newd = document.createElement('div')
            newd.style.textAlign = 'center'
            newd.style.color = '#888'
            newd.style.fontSize = "12px";
            newd.innerText = v
            document.getElementById('main').appendChild(newd)
        })

    }
    function sub() {
        console.log('sub',document.getElementById('c').value)
        socket.emit('sendmsg',document.getElementById('c').value )
    }
    document.addEventListener('keydown',function(e){
        console.log()
        if(e.keyCode == 13){
            sub()
        }
    })
</script>

</html>